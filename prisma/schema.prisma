// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  CUSTOMER
  HOST
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum PropertyType {
  RIAD
  VILLA
  APARTMENT
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  firstName String
  lastName  String
  phone     String?
  role      UserRole @default(CUSTOMER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  bookings Booking[]
  reviews  Review[]
  payments Payment[]

  @@map("users")
}

model Property {
  id          String       @id @default(uuid())
  slug        String       @unique
  title       String
  description String       @db.Text
  type        PropertyType
  pricePerNight Float
  cleaningFee Float        @default(0)
  weeklyDiscount Float      @default(0)
  
  // Location
  address     String
  city        String       @default("Marrakech")
  country     String       @default("Morocco")
  latitude    Float?
  longitude   Float?
  
  // Capacity
  guests      Int
  bedrooms    Int
  bathrooms   Int
  
  // Features
  images      PropertyImage[]
  amenities   PropertyAmenity[]
  
  // Status
  isActive    Boolean      @default(true)
  featured    Boolean      @default(false)
  
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  bookings    Booking[]
  reviews     Review[]

  @@map("properties")
}

model PropertyImage {
  id         String   @id @default(uuid())
  url        String
  alt        String
  isMain     Boolean  @default(false)
  propertyId String
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@map("property_images")
}

model Amenity {
  id          String   @id @default(uuid())
  name        String   @unique
  icon        String
  description String?
  
  properties PropertyAmenity[]

  @@map("amenities")
}

model PropertyAmenity {
  id         String   @id @default(uuid())
  propertyId String
  amenityId  String
  
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  amenity    Amenity  @relation(fields: [amenityId], references: [id], onDelete: Cascade)

  @@unique([propertyId, amenityId])
  @@map("property_amenities")
}

model Booking {
  id             String        @id @default(uuid())
  checkIn        DateTime
  checkOut       DateTime
  guests         Int
  totalPrice     Float
  cleaningFee    Float         @default(0)
  discount       Float         @default(0)
  status         BookingStatus @default(CONFIRMED)
  
  // Guest information
  guestFirstName String
  guestLastName  String
  guestEmail     String
  guestPhone     String
  
  // Relations
  userId         String
  propertyId     String
  user           User          @relation(fields: [userId], references: [id])
  property       Property      @relation(fields: [propertyId], references: [id])
  
  payment        Payment?
  
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  @@map("bookings")
}

model Payment {
  id              String        @id @default(uuid())
  amount          Float
  currency        String        @default("EUR")
  status          PaymentStatus @default(PENDING)
  
  // Stripe integration (prepared for future implementation)
  stripePaymentId String?       @unique
  stripeCustomerId String?
  
  // Relations
  bookingId       String        @unique
  userId          String
  booking         Booking       @relation(fields: [bookingId], references: [id])
  user            User          @relation(fields: [userId], references: [id])
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@map("payments")
}

model Review {
  id         String   @id @default(uuid())
  rating     Int      // 1-5
  comment    String   @db.Text
  
  // Relations
  userId     String
  propertyId String
  user       User     @relation(fields: [userId], references: [id])
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([userId, propertyId])
  @@map("reviews")
}
